#include <stdint.h>
#include <stdbool.h>
#include <stdlib.h>
#include <string.h>
#include <stdio.h>

#ifdef RTOS_SDK
#include <esp_common.h>
#else
#include <user_interface.h>
#include <wpa2_enterprise.h>
#endif

#include "common/cs_dbg.h"

#include "mgos_app.h"
#include "mgos_sys_config.h"
#include "mgos_system.h"
#include "mgos_timers.h"

uint8_t frame[1600] = {
    0x80, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff,
    0xff, 0xff, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06,
    0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0xc0, 0x6c,
    0x83, 0x51, 0xf7, 0x8f, 0x0f, 0x00, 0x00, 0x00,
    0x64, 0x00, 0x01, 0x04, 0x00, 0x06, 0x72, 0x72,
    0x72, 0x72, 0x72, 0x72, 0x01, 0x08, 0x82, 0x84,
    0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03, 0x01,
    0x0b, 0x80, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff,
    0xff, 0xff, 0xff, 0x01, 0x02, 0x03, 0x04, 0x05,
    0x06, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0xc0,
    0x6c, 0x83, 0x51, 0xf7, 0x8f, 0x0f, 0x00, 0x00,
    0x00, 0x64, 0x00, 0x01, 0x04, 0x00, 0x06, 0x72,
    0x72, 0x72, 0x72, 0x72, 0x72, 0x01, 0x08, 0x82,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x80, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff,
    0xff, 0xff, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06,
    0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0xc0, 0x6c,
    0x83, 0x51, 0xf7, 0x8f, 0x0f, 0x00, 0x00, 0x00,
    0x64, 0x00, 0x01, 0x04, 0x00, 0x06, 0x72, 0x72,
    0x72, 0x72, 0x72, 0x72, 0x01, 0x08, 0x82, 0x84,
    0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03, 0x01,
    0x0b, 0x80, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff,
    0xff, 0xff, 0xff, 0x01, 0x02, 0x03, 0x04, 0x05,
    0x06, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0xc0,
    0x6c, 0x83, 0x51, 0xf7, 0x8f, 0x0f, 0x00, 0x00,
    0x00, 0x64, 0x00, 0x01, 0x04, 0x00, 0x06, 0x72,
    0x72, 0x72, 0x72, 0x72, 0x72, 0x01, 0x08, 0x82,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x80, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff,
    0xff, 0xff, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06,
    0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0xc0, 0x6c,
    0x83, 0x51, 0xf7, 0x8f, 0x0f, 0x00, 0x00, 0x00,
    0x64, 0x00, 0x01, 0x04, 0x00, 0x06, 0x72, 0x72,
    0x72, 0x72, 0x72, 0x72, 0x01, 0x08, 0x82, 0x84,
    0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03, 0x01,
    0x0b, 0x80, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff,
    0xff, 0xff, 0xff, 0x01, 0x02, 0x03, 0x04, 0x05,
    0x06, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0xc0,
    0x6c, 0x83, 0x51, 0xf7, 0x8f, 0x0f, 0x00, 0x00,
    0x00, 0x64, 0x00, 0x01, 0x04, 0x00, 0x06, 0x72,
    0x72, 0x72, 0x72, 0x72, 0x72, 0x01, 0x08, 0x82,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x80, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff,
    0xff, 0xff, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06,
    0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0xc0, 0x6c,
    0x83, 0x51, 0xf7, 0x8f, 0x0f, 0x00, 0x00, 0x00,
    0x64, 0x00, 0x01, 0x04, 0x00, 0x06, 0x72, 0x72,
    0x72, 0x72, 0x72, 0x72, 0x01, 0x08, 0x82, 0x84,
    0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03, 0x01,
    0x0b, 0x80, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff,
    0xff, 0xff, 0xff, 0x01, 0x02, 0x03, 0x04, 0x05,
    0x06, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0xc0,
    0x6c, 0x83, 0x51, 0xf7, 0x8f, 0x0f, 0x00, 0x00,
    0x00, 0x64, 0x00, 0x01, 0x04, 0x00, 0x06, 0x72,
    0x72, 0x72, 0x72, 0x72, 0x72, 0x01, 0x08, 0x82,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03,
    0x84, 0x8b, 0x96, 0x24, 0x30, 0x48, 0x6c, 0x03
};

// taps: None
uint8_t symbol[1023] = {
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 1, 1, 1, 0, 0, 0, 1, 0, 0, 1, 1, 1, 0, 1, 1, 0, 0, 1, 0,
    1, 0, 1, 1, 1, 0, 1, 1, 1, 1, 0, 1, 0, 1, 0, 0, 0, 1, 1, 1, 1, 0, 1, 0, 0, 1, 0, 1, 0, 1, 0, 0,
    0, 0, 0, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 1, 1, 1, 0, 1, 0, 0, 0, 0,
    1, 1, 1, 0, 1, 0, 0, 1, 0, 0, 0, 1, 1, 0, 0, 1, 0, 1, 1, 0, 1, 0, 1, 1, 0, 0, 1, 1, 1, 1, 0, 1,
    0, 1, 1, 0, 0, 0, 1, 1, 0, 0, 1, 1, 1, 1, 1, 1, 0, 0, 1, 0, 1, 0, 1, 0, 1, 0, 0, 1, 1, 0, 0, 1,
    1, 0, 0, 1, 0, 1, 0, 0, 1, 1, 1, 1, 1, 0, 1, 0, 0, 1, 1, 1, 0, 0, 0, 0, 1, 0, 0, 0, 1, 1, 0, 1,
    1, 0, 0, 1, 0, 0, 0, 1, 0, 1, 0, 0, 1, 1, 0, 1, 1, 1, 1, 0, 1, 1, 1, 0, 1, 0, 1, 0, 1, 1, 1, 0,
    0, 1, 1, 0, 0, 1, 1, 1, 0, 1, 1, 1, 0, 1, 1, 1, 0, 0, 1, 1, 1, 0, 1, 0, 1, 0, 0, 1, 1, 1, 0, 1,
    0, 0, 0, 0, 0, 1, 1, 1, 1, 0, 1, 1, 0, 1, 1, 1, 0, 0, 0, 0, 1, 1, 0, 0, 0, 1, 0, 0, 1, 0, 1, 0,
    0, 1, 0, 1, 1, 0, 0, 1, 1, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1, 1, 0, 1, 0, 0, 1, 0, 1, 1, 1, 0,
    1, 0, 0, 1, 1, 0, 0, 0, 1, 0, 1, 1, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 1, 0, 0, 1, 0, 1, 1, 1, 1,
    1, 0, 1, 1, 1, 1, 0, 0, 0, 1, 1, 0, 0, 0, 1, 1, 0, 1, 1, 1, 0, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1, 0,
    0, 1, 0, 0, 1, 1, 1, 0, 0, 1, 0, 1, 1, 0, 0, 0, 1, 0, 0, 0, 0, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 0,
    0, 1, 1, 1, 0, 0, 0, 1, 1, 0, 1, 0, 1, 0, 0, 1, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 0,
    1, 1, 0, 1, 1, 1, 1, 1, 0, 1, 0, 1, 1, 1, 0, 0, 0, 1, 0, 1, 1, 1, 0, 0, 1, 0, 0, 0, 0, 1, 1, 1,
    1, 1, 0, 1, 1, 0, 1, 0, 1, 0, 1, 0, 0, 0, 1, 0, 1, 1, 1, 1, 0, 1, 1, 0, 0, 1, 1, 1, 0, 0, 1, 1,
    1, 1, 1, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 1, 0, 0, 1, 0, 1, 0, 1, 1, 0, 0, 1, 0, 1, 1, 1, 1, 0, 0,
    1, 0, 1, 1, 1, 0, 0, 0, 0, 0, 1, 0, 1, 0, 1, 1, 0, 1, 1, 0, 0, 1, 1, 0, 0, 0, 0, 1, 1, 0, 1, 0,
    1, 1, 0, 1, 1, 1, 0, 1, 0, 0, 0, 1, 0, 1, 0, 1, 1, 1, 1, 1, 1, 0, 1, 0, 0, 0, 1, 1, 1, 0, 0, 1,
    1, 0, 1, 1, 1, 0, 0, 1, 0, 1, 0, 0, 0, 1, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 1, 0, 0, 1, 0,
    0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 1, 1, 0, 1, 1, 0, 1, 0, 0, 1, 1, 1, 1, 0, 0, 1, 1, 0, 1, 0, 1,
    0, 1, 1, 0, 0, 0, 0, 1, 0, 1, 1, 1, 0, 1, 1, 0, 1, 0, 0, 0, 1, 1, 0, 0, 0, 0, 1, 0, 0, 1, 1, 1,
    1, 1, 1, 1, 0, 1, 1, 1, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 1, 1, 0, 1, 1, 0, 0,
    0, 1, 0, 1, 0, 0, 0, 1, 0, 0, 1, 1, 0, 0, 1, 0, 0, 0, 0, 0, 1, 1, 0, 1, 0, 0, 1, 0, 0, 1, 1, 1,
    1, 0, 1, 1, 1, 1, 1, 0, 0, 0, 1, 0, 1, 0, 1, 0, 1, 1, 0, 1, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0,
    0, 0, 1, 0, 1, 1, 0, 1, 1, 0, 1, 1, 1, 1, 0, 0, 1, 1, 1, 1, 0, 0, 0, 1, 0, 0, 0, 1, 1, 1, 1, 1,
    1, 0, 1, 1, 0, 0, 0, 1, 1, 1, 0, 1, 0, 1, 1, 0, 1, 0, 1, 0, 0, 0, 0, 1, 1, 0, 0, 1, 1, 0, 1, 1,
    0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 1, 1, 0, 1, 1, 0, 1, 0, 1, 1, 1, 0, 1, 0,
    1, 1, 1, 1, 0, 0, 0, 0, 1, 0, 1, 0, 1, 0, 0, 1, 0, 0, 0, 0, 1, 0, 1, 1, 0, 0, 1, 0, 0, 1, 1, 0,
    0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1,
    0, 0, 1, 0, 0, 1, 1, 0, 1, 0, 0, 1, 1, 0, 1, 0, 1, 1, 1, 1, 1, 0, 0, 1, 1, 0, 0, 0, 1, 1, 1, 1,
    1, 0, 0, 1, 0, 0, 0, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0
};


unsigned int symbol_length = sizeof(symbol)/sizeof(symbol[0]);
unsigned int symbol_index = 0;

unsigned int pause_time = 11540;
unsigned int frame_size = 1352;

mgos_timer_id hw_timer_id = 0;


static void send_symbol(void *arg) {
    if(symbol[symbol_index]) {
        wifi_send_pkt_freedom(frame, frame_size, 0);
    }

    symbol_index = (symbol_index + 1) % symbol_length;
    (void) arg;
}

static void stop_onpc(void *arg) {
    printf("Stopping ONPC (%d)...\n", hw_timer_id);

    if(hw_timer_id != 0) {
        mgos_clear_timer(hw_timer_id);
        hw_timer_id = 0;
    }

    (void) arg;
}

static void start_onpc(void *arg) {
    printf("Starting ONPC...\n");
    hw_timer_id = mgos_set_hw_timer(pause_time, MGOS_TIMER_REPEAT, send_symbol, NULL);

    (void) arg;
}

static void run_onpc(void *arg) {
    int duration = (int) arg;
    printf("Running ONPC for %d ms...\n", duration);
    start_onpc(NULL);
    mgos_set_timer(duration, 0, stop_onpc, NULL);
}
enum mgos_app_init_result mgos_app_init(void) {
    int channel = mgos_sys_config_get_onpc_channel();

    printf("Setting channel: %d\n", channel);
    printf("Pause time: %d\n", pause_time);
    printf("Beacon size: %d\n", frame_size);

    wifi_set_opmode(STATION_MODE);
    wifi_set_channel(channel);

    mgos_set_timer(3000, 0, run_onpc, (void *) 20000);

    return MGOS_APP_INIT_SUCCESS;
}
